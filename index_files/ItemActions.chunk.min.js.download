(("undefined"!=typeof self?self:this).webpackJsonp_pro_gallery_santa_wrapper=("undefined"!=typeof self?self:this).webpackJsonp_pro_gallery_santa_wrapper||[]).push([[4],{164:function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return h})),o.d(t,"itemActions",(function(){return p}));var i=o(4),s=o.n(i),r=o(10),a=o(19),n=o(126),l=o(1),c=o(57),h=function(){function e(){this.getLoveCount=this.getLoveCount.bind(this),this.wasInit=!1,this.loveCounts={},this.fetchSiteInfo()}var t=e.prototype;return t.initWidgetData=function(e){if(this.config=e,e.compId&&(this.compId=e.compId),e.pageId&&(this.pageId=e.pageId),e.styleId&&(this.styleId=e.styleId),e.pageUrl&&(this.pageUrl=e.pageUrl),"boolean"==typeof e.isStoreGallery&&(this.isStoreGallery=e.isStoreGallery),e.galleryId&&(this.galleryId=e.galleryId),e.viewMode&&(this.viewMode=e.viewMode),e.fullscreenUrl){this.siteUrl=this.fullscreenUrl=this.normalizeFullscreenUrl(e.fullscreenUrl);try{this.siteUrl=this.fullscreenUrl.match(/.*\..*\//g)[0]}catch(e){}}return e.onLoveCountsFetched&&(this.onLoveCountsFetched=e.onLoveCountsFetched),this.baseUrl=e.baseUrl||"//progallery.wix.com",e.reachLevel&&this.setReachLevel(e.reachLevel),!r.a.isSSR()&&"site"===this.viewMode.toLowerCase()&&this.galleryId&&""!==this.galleryId&&this.getStats(),this.wasInit=e,Date.now()},t.normalizeFullscreenUrl=function(e){var t=e;return e&&(t=e.split("?")[0]),t},t.fetchSiteInfo=function(){var e,t=this;try{e=l.a.location.href}catch(t){e=""}r.a.isInWix()?(this.siteInfo={},a.a.getSiteInfo((function(e){t.siteInfo=e}))):this.siteInfo={url:e,baseUrl:e,siteTitle:"Wix Pro Gallery",siteDescription:"The best gallery any Wix user has ever seen!",siteKeywords:"gallery,photos,photographer,professional"}},t.getSiteUrl=function(){return this.siteInfo.url},t.getStats=function(){var e=this;if("site"===this.viewMode.toLowerCase()&&!r.a.isDev()&&!r.a.isTest()){if(!this.galleryId||""===this.galleryId||this.galleryId.length<10)return console.log("galleryId id",this.galleryId,typeof this.galleryId),void console.error("get stats error - no galleryId");var t;fetch(this.baseUrl+"/_api/pro-gallery-webapp/v1/gallery/"+this.galleryId+"/stats/properties").then((function(e){return e.json()})).then((function(t){try{t.properties?e.statsProps=JSON.parse(t.properties):t.statsToken&&(e.statsProps={instance_id:e.config.instanceId,set_id:e.galleryId}),e.statsToken=t.statsToken}catch(e){console.error("Failed getting stats props",e)}}));try{t=this.config.instanceId||l.a.instanceId}catch(e){t=""}t?fetch(this.baseUrl+"/_api/pro-gallery-webapp/v1/gallery/"+this.galleryId+"/"+t+"/stats").then((function(e){return e.json()})).then((function(t){try{t&&t.photoId2Love&&(e.loveCounts=t.photoId2Love,e.onLoveCountsFetched&&e.onLoveCountsFetched(e.loveCounts))}catch(e){console.error("Failed getting love counts",e)}})):console.warn("cannot report love counter - no instance id")}},t.getLoveCount=function(e){return Math.max(0,this.loveCounts[e])||0},t.html2img=function(e,t){o.e(9).then(o.t.bind(null,696,7)).then((function(o){try{var i=l.a.document.createElement("div");i.innerHTML=e.html,i.style.boxSizing="border-box",i.style.background=e.style.bgColor,i.style.position="absolute",i.style.top=0,i.style.left=0,i.style.zIndex=-1,i.className="text-item",l.a.document.body.appendChild(i),o(i).then((function(e){i.remove();var o=e.toDataURL();"function"==typeof t&&t(o)}))}catch(e){"function"==typeof t&&t("")}}))},t.share=function(e,t,o){r.a.isDemo()||(o&&(t.numOfItems=o),this.shareImp(e,t))},t.downloadTextItem=function(e){this.html2img(e,(function(e){try{e=e.replace(/^data:image\/[^;]/,"data:application/octet-stream"),l.a.open(e)}catch(e){}}))},t.getReachLevel=function(e){var t,o=Number(e||0);if(s.a.isUndefined(this.reachLevel)){var i=r.a.getLocalStorage();t=Number(i[this.siteUrl+"|reach-level"]||0)+o}else t=this.reachLevel+o;return t},t.setReachLevel=function(e){e>0||(e=0);try{var t=this.getReachLevel(0);if(e>0&&0===t&&s.a.isUndefined(this.reachLevel))r.a.getLocalStorage()[this.siteUrl+"|reach-level"]=e,this.reachLevel=e}catch(e){console.warn("set reach level error",e)}},t.getShareUrl=function(e){return!c.b.getExperimentBoolean("specs.pro-gallery.newFullscreenShare")||r.a.isStoreGallery()||this.isStoreGallery?this.fullscreenUrl+"/"+this.compId+"/"+this.getItemId(e)+"/"+e.idx+"/"+encodeURIComponent("?i="+e.idx+"&p="+this.pageId+"&s="+this.styleId+"&rl="+this.getReachLevel(1)+(e.hashtag?"&ht="+e.hashtag:"")):this.pageUrl+"?pgid="+this.compId.replace("comp-","")+"-"+this.getItemId(e)},t.getItemId=function(e){return e.id||e.photoId||e.itemId},t.shareImp=function(e,t,o){var i={id:this.getItemId(t),idx:t.idx||0,url:t.createUrl&&t.createUrl("sample","img"),title:t.title||t.description||this.siteInfo.siteTitle,hashtag:t.hashtag},a=encodeURIComponent(this.getShareUrl(i)),n=encodeURIComponent(i.title||""),c=encodeURIComponent(i.url),h=encodeURIComponent(this.siteInfo.siteKeywords),p=encodeURIComponent(""+this.getShareUrl(i));switch(s.a.isFunction(o)||(o=function(e,t){try{if(r.a.isiOS()&&"Email"===t)l.a.location.href=e;else{var o=l.a.open(e,t+" Share","height=640,width=960,toolbar=no,menubar=no,scrollbars=no,location=no,status=no");setTimeout((function(){try{"Email"===t&&o.location.hasOwnProperty("pathname")&&"blank"===o.location.pathname&&o.close()}catch(e){console.warn("Could not close mailto window")}}),5e3)}}catch(e){}}),e){case"facebook":o("http://www.facebook.com/sharer/sharer.php?u="+a+"&t="+n,"Facebook");break;case"twitter":var d="&amp;text="+("undefined"===n?"":n);if(d.length>110)d=d.slice(0,107)+"...";else{var g="&amp;hashtags="+h;(d+g).length<=110&&(d+=g)}o("https://twitter.com/intent/tweet?url="+a+d,"Twitter");break;case"pinterest":o("https://pinterest.com/pin/create/button/?url="+a+"&media="+c.replace("webp","jpg")+"&description="+n,"Pinterest");break;case"google":o("https://plus.google.com/share?url="+a,"Google Plus");break;case"tumblr":o("http://www.tumblr.com/share/link?url="+a,"Tumblr");break;case"email":o("mailto:?Subject="+n+"&body="+p,"Email")}},t.reportLoveToStats=function(e,t){try{if(!this.statsProps||!this.statsProps.instance_id)return void this.getStats();var o=s.a.merge(this.statsProps,{photo_id:e}),i=this.statsToken||l.a.statsToken,a=r.a.generateUUID();fetch(l.a.location.protocol+"//photographers-counters.wix.com/collector/rest/collect-js?ctToken="+i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageId:a,metrics:[{type:"photo",reportMetrics:[{name:"love",value:String(t)}],properties:o}]})}).then((function(e){console.log("Success report love",e)}))}catch(e){console.error("Error reporting love to stats",e)}},t.getLoveStorageKey=function(e){return"pro-gallery-item-love-"+e},t.isLoved=function(e){try{return void 0!==r.a.getLocalStorage()&&(!!r.a.getLocalStorage()[this.getLoveStorageKey(e)]||!1)}catch(e){console.warn("isLoved failed",e)}},t.toggleLove=function(e,t){try{if(!r.a.getLocalStorage())return!1;var o;this.isLoved(e)&&!0!==t||!1===t?(r.a.getLocalStorage()[this.getLoveStorageKey(e)]="",o=-1):(r.a.getLocalStorage()[this.getLoveStorageKey(e)]=!0,o=1),this.reportLoveToStats(e,o)}catch(e){console.warn("toggleLove failed",e)}},t.isFirstLoveClick=function(e){try{return void 0===r.a.getLocalStorage()[this.getLoveStorageKey(e)]}catch(e){console.warn("isFirstLoveClick failed",e)}},t.postLoveActivity=function(e){var t=this.getItemId(e);this.isFirstLoveClick(t)&&function(e){try{var t={type:a.a.Activities.Type.SOCIAL_TRACK,info:{type:e.activityType,channel:e.activityNetwork,itemInfo:{itemUrl:e.url,itemId:e.id,itemType:e.type.toUpperCase()}},details:{additionalInfoUrl:e.url,summary:""},contactUpdate:null};a.a.Activities.postActivity(t,(function(e){console.log("Activity ID: "+e.activityId+", Contact ID: "+e.contactId)}),(function(e){console.log("Failure message:",e)}))}catch(e){console.log("error posting activity.",e)}}({activityType:"LOVE",activityNetwork:"SITE",id:t,url:this.getShareUrl(e),type:e.type})},t.showTooltip=function(e,t,o){if(!(document.getElementsByClassName("pro-tooltip").length>=1)){var i=e.currentTarget;if(i){var s,r,a=i.getBoundingClientRect(),c=a.top,h=a.left;try{r=l.a.innerWidth}catch(e){r=980}switch(void 0===o&&(o=h>r/2?"right":"left"),o){case"top":s={top:c-30+"px",left:h+28+"px",opacity:1};break;case"right":s={top:c-4+"px",left:h-20+"px",opacity:1};break;default:case"left":s={top:c-4+"px",left:h+40+"px",opacity:1}}s["pointer-events"]="none";var p=l.a.document.createElement("div");p.classList.add("pro-tooltip"),p.classList.add(o),Object.assign(p.style,s),p.innerHTML=n.a.getByKey(t),l.a.document.body.appendChild(p)}}},t.hideTooltip=function(){l.a.document.body.removeChild(document.getElementsByClassName("pro-tooltip")[0])},t.toggleTooltip=function(e,t,o){1===document.getElementsByClassName("pro-tooltip").length?this.hideTooltip():this.showTooltip(e,t,o)},t.viewClassName=function(e,t){return"fullscreen"===e&&"desktop"===t?"fullscreen-icon":""},e}(),p=new h}}]);
//# sourceMappingURL=ItemActions.chunk.min.js.map